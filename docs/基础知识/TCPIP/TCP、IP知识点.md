# TCP/IP知识点

- TCP使用不可靠的IP服务，并且提供一种可靠的IP服务
- UDP为应用程序发送和接收数据报，和TCP不同，UDP不可靠
- IP是网络层上的主要协议，同时被TCP和UDP使用
- ICMP是IP协议的附属协议。

- ping是一个应用程序，ping调用了ICMP



- MTU：最大传输单元，目的是交互使用提供足够快的响应时间
  - 以太网的数据帧的物理特性是长度（MTU）必须在46~1500字节之内（不包含以太网首部（14）和尾部（4），IP首部（20）+TCP首部（20）+应用数据）。
  - 如果大于MTU，就需要进行分片。
  - 两台通信主机路径中的最小MTU，成为路径MTU
  - 路径MTU在两个方向上不一定是一直的
  - MTU是计算，数据流出方向
  - 路径传输过程可能多次分片，组装只在目的地组装



- 为什么IP不是可靠连接的协议
  - **IP层没有超时和重传机制，没有连接握手协议**

- IP数据报经过路由器都做了哪些改动
  - IP没经过一个路由器，TTL数就会减一，如果最后TTL为0了，但是依然没有到达目的地，这个IP包将会被丢弃。
  - 这样做了目的是为了防止出现循环回路。并且最后一跳的路由器会发送一个ICMP不可达的数据包给源IP。
- IP路由选择
  - 大多数主机和一些路由器，可以使用默认路由来处理任何目的，除非它在本地局域网上
  - 数据报中的目的IP地址始终不变，只有使用源路由选项时，目的IP地址才有可能被修改
  - 每个链路层可能具有不同的首部帧，而且链路层的目的地址（如果有的话）始终指向下一跳（网关）的链路层地址。
- 分片问题
  - IP数据包的长度为16，也就是说最大为65535个字节。但是我们知道**数据链路层规定MTU最大传输单元为1500个字节**。
  - 当IP数据包的大小超过了1500，IP数据包必须要进行分片处理。这还只是初始发送端的分片，在网络中如果某个路由器的MTU小于1500，那么还需要在路由器端做分片，这就给IP包的完整接收照成了很大的不确定性（我们知道数据包达到终点不一定是按照顺序的），因为万一某一个分片丢失，可能会造成整个IP重传，当然**前提是高层协议支持重传**。对于**TCP协议，不存在分片的问题，因为TCP报头的选项字段有MSS字段，规定一个TCP包最大可传输的字节数，一般是1500-20-20=1460字节。也就是说到达IP封包的时候最大可承载数据只有1460个字节，这样就可以避免分片的问题**。但是对于UDP这一类的协议，分片操作还是交给IP完成，虽然这样可以增加载荷的效率，但是稳定性会受到很大的影响。

